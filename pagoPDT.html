<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Servicios Ramirez</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .row { display: flex; gap: 20px; flex-wrap: wrap; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .metodos-pago { margin: 20px 0; }
        .metodo { display: block; margin-bottom: 10px; padding: 10px; border: 1px solid #e30613; cursor: pointer; }
        .metodo input { width: auto; margin-right: 10px; }
        .carrito-resumen { background: #f8f8f8; padding: 20px; border-radius: 4px; }
        .total { font-size: 1.5em; font-weight: bold; color: #e30613; }
        button { width: 100%; padding: 15px; background: #e30613; color: white; border: none; font-weight: bold; cursor: pointer; font-size: 1.1em; }
    </style>
</head>
<body>
    <h2>Finalizar Compra</h2>

    
    <div class="row">
        <!-- Formulario Dirección y Pago -->
        <div style="flex: 2;">
            <h3>Dirección de Envío</h3>
            <form id="formCheckout">
                <div class="row">
                    <div style="flex: 1; padding-right: 10px;">
                        <label for="nombre">Nombre Completo</label>
                        <input type="text" id="nombre" name="nombre" autocomplete="name" required>
                    </div>
                    <div style="flex: 1; padding-left: 10px;">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" autocomplete="email" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="direccion1">Dirección Línea 1</label>
                    <input type="text" id="direccion1" name="direccion1" autocomplete="address-line1" required>
                </div>
                
                <div class="form-group">
                    <label for="direccion2">Dirección Línea 2 (opcional)</label>
                    <input type="text" id="direccion2" name="direccion2" autocomplete="address-line2">
                </div>
                
                <div class="row">
                    <div style="flex: 1; padding-right: 10px;">
                        <label for="ciudad">Ciudad</label>
                        <input type="text" id="ciudad" name="ciudad" autocomplete="address-level2" required>
                    </div>
                    <div style="flex: 1; padding-left: 10px;">
                        <label for="codigoPostal">Código Postal</label>
                        <input type="text" id="codigoPostal" name="codigoPostal" autocomplete="postal-code" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="pais">País</label>
                    <select id="pais" name="pais" autocomplete="country" required>
                        <option value="">Seleccionar...</option>
                        <option value="CL">Chile</option>
                    </select>
                </div>

                <hr>
                
                <h3>Método de Pago</h3>
                <div class="metodos-pago">
                    <div class="metodo">
                        <input type="radio" id="tarjeta" name="pago" value="tarjeta" checked required>
                        <label for="tarjeta">Tarjeta de Crédito/Débito</label>
                    </div>
                    <div class="metodo">
                        <input type="radio" id="paypal" name="pago" value="paypal">
                        <label for="paypal">PayPal</label>
                    </div>
                    <div class="metodo">
                        <input type="radio" id="transferencia" name="pago" value="transferencia">
                        <label for="transferencia">Transferencia Bancaria</label>
                    </div>
                </div>
                
                <!-- Campos tarjeta (muestra/oculta según selección) -->
                <div id="camposTarjeta" style="display: block;">
                    <div class="form-group">
                        <label for="numeroTarjeta">Número de Tarjeta</label>
                        <input type="text" id="numeroTarjeta" autocomplete="cc-number" inputmode="numeric" pattern="[0-9\s]{13,19}" maxlength="19">
                    </div>
                    <div class="row">
                        <div style="flex: 1; padding-right: 10px;">
                            <label for="expiracion">Expiración (MM/AA)</label>
                            <input type="text" id="expiracion" autocomplete="cc-exp" inputmode="numeric" pattern="^(0[1-9]|1[0-2])/[0-9]{2}$" maxlength="5">
                        </div>
                        <div style="flex: 1; padding-left: 10px;">
                            <label for="cvv">CVV</label>
                            <input type="text" id="cvv" autocomplete="cc-csc" inputmode="numeric" pattern="[0-9]{3,4}" maxlength="4">
                        </div>
                    </div>
                </div>

                <button type="submit">Confirmar Pedido y Pagar</button>
            </form>
        </div>
        
        <!-- Resumen Carrito -->
        <div class="carrito-resumen" style="flex: 1; min-width: 300px;">
            <h3>Tu Carrito</h3>
            <div id="listaItems"></div>
            <div class="total" id="total">Total: $0</div>
            <hr>
            <small>Envío calculado al confirmar.</small>
        </div>
    </div>

    <script>
        // Cargar carrito desde localStorage
        function cargarCarrito() {
            const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            const lista = document.getElementById('listaItems');
            const totalEl = document.getElementById('total');
            let total = 0;

            if (carrito.length === 0) {
                lista.innerHTML = '<p>Carrito vacío. <a href="index.html">Volver a tienda</a></p>';
                return;
            }

            lista.innerHTML = '';
            carrito.forEach(item => {
                const div = document.createElement('div');
                div.innerHTML = `<strong>${item.nombre}</strong> - $${item.precio}<br><small>Cantidad: 1</small>`;
                lista.appendChild(div);
                total += item.precio;
            });
            totalEl.textContent = `Total: $${total}`;
        }

        // Mostrar/ocultar campos tarjeta
        document.querySelectorAll('input[name="pago"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('camposTarjeta').style.display = this.value === 'tarjeta' ? 'block' : 'none';
            });
        });

        // Submit simulado (envía datos a tu backend o email)
        document.getElementById('formCheckout').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!this.checkValidity()) {
                this.reportValidity();
                return;
            }
            alert('¡Pedido confirmado! Redirigiendo a pago... (Integra Stripe/PayPal aquí)');
            // Aquí: envía datos con fetch a tu servidor o integra pasarela real
            console.log('Datos:', new FormData(this));
        });

        cargarCarrito();
    </script>
    <script>
const urlParams = new URLSearchParams(window.location.search);
const total = parseInt(urlParams.get('total') || 0);
document.querySelector('span[class*="total"], .total, #total, .monto').innerText = '$' + total.toLocaleString();
</script>

</body>
</html>
